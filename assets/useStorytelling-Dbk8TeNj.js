import{aS as y,r as b,K as D}from"./index--6StonPM.js";function P(n){let e=null;const o=u=>{let c=0;y(n.value,d=>{d.easeTo({center:u,duration:0})});const h=()=>{y(n.value,d=>{d.rotateTo(c,{duration:0})}),c+=.2,e=requestAnimationFrame(h)};h()},a=()=>{e!==null&&(cancelAnimationFrame(e),e=null)};return{orbitAround:u=>({add:()=>{y(n.value,c=>{c.flyTo({center:u.center}),o(u.center)})},remove:()=>a()}),orbitAroundCurrent:()=>({add:()=>{y(n.value,u=>{const c=u.getCenter().toArray();o(c)})},remove:()=>a()})}}function R(n){return{drawRoute:({geojson:e})=>({add:()=>{m(n.value,o=>{var a;(a=o.getSource("route"))==null||a.setData(e)})},remove:()=>{m(n.value,o=>{var a;(a=o.getSource("route"))==null||a.setData({type:"FeatureCollection",features:[]})})}}),zoomTo:e=>({add:()=>{m(n.value,o=>{o.flyTo({center:e.center,zoom:e.zoom})})}}),panTo:e=>({add:()=>{m(n.value,o=>{o.panTo(e.center)})}}),rotateTo:({angle:e})=>({add:()=>{m(n.value,o=>{o.rotateTo(e)})}})}}function m(n,e){y(n,o=>{o.isStyleLoaded()?e(o):o.once("load",()=>e(o))})}function G(n){const{chapters:e,globalActions:o={},autoPlay:a=!1,autoNext:u=!0,delayStart:c=0,loop:h=!1,speed:d}=n,l=b(0),A=b(!1),C=b(d||1);let T=null;const w=()=>{A.value=!0,M()},x=()=>{A.value=!1,S()},E=()=>{l.value<e.length-1?p(l.value+1):h?p(0):x()},L=()=>{l.value>0&&p(l.value-1)},p=t=>{t<0||t>=e.length||(O(t),l.value=t,M())},M=()=>{var r,f;const t=e[l.value];console.log("test",l.value,"start"),console.log("test",l.value,"start","chapter",t),(r=t.onEnter)==null||r.call(t);for(const s of t.actions??[]){console.log("test",l.value,"start","action",s);const i=q(s);(f=i==null?void 0:i.add)==null||f.call(i)}u&&t.duration&&(S(),T=window.setTimeout(()=>{var s;console.log("test",l.value,"start","exit"),(s=t.onExit)==null||s.call(t),E()},t.duration/C.value))},O=t=>{var i,z,F;console.log("test",l.value,"end","exit");const r=e[l.value];console.log("test",l.value,"end","chapter",r);const f=e[t],s=new Set(((i=f==null?void 0:f.actions)==null?void 0:i.map(v=>v.type))??[]);(z=r==null?void 0:r.onExit)==null||z.call(r);for(const v of(r==null?void 0:r.actions)??[])if(console.log("test",l.value,"end","action",v,s,s.has(v.type)),!s.has(v.type)){const g=q(v);(F=g==null?void 0:g.remove)==null||F.call(g),console.log("test",l.value,"end","remove action",v)}S()},q=t=>{if(t.custom)return{add:t.add,remove:t.remove};if(o[t.type])return o[t.type](t.payload)},S=()=>{T!==null&&(clearTimeout(T),T=null)};return a&&setTimeout(w,c),D(()=>{S()}),{currentIndex:l,currentSpeed:C,isPlaying:A,play:w,pause:x,next:E,prev:L,goTo:p}}function N(n,e){return G({...e,globalActions:{highlightElement:({selector:o})=>({add:()=>{var a;return(a=document.querySelector(o))==null?void 0:a.classList.add("highlight")},remove:()=>{var a;return(a=document.querySelector(o))==null?void 0:a.classList.remove("highlight")}}),...R(n),...P(n),...e.globalActions}})}export{N as u,m as w};
