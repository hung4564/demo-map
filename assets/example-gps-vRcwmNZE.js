import{a_ as z,a$ as k,b0 as H,b1 as S,b2 as R,b3 as J,b4 as K,b5 as O,d as Q,A,b6 as U,c as W,o as I,w as V,a as i,b as p,u as n,ap as X,_ as Y,as as F,f as aa,at as ta,g as ea,h as na,i as ra,M as sa,B as oa,an as la,j as ia,S as da,af as ua,l as ca,b7 as pa,b8 as ma,a7 as ga}from"./index-CRtOk2sP.js";import{c as fa,u as va,w as D}from"./useStorytelling-CvQw7tB0.js";function Ma(M,m,l,d){d===void 0&&(d={});var s=z(M),o=k(s[0]),r=k(s[1]),c=k(l),u=H(m,d.units),g=Math.asin(Math.sin(r)*Math.cos(u)+Math.cos(r)*Math.sin(u)*Math.cos(c)),y=o+Math.atan2(Math.sin(c)*Math.sin(u)*Math.cos(r),Math.cos(u)-Math.sin(r)*Math.sin(g)),b=R(y),C=R(g);return S([b,C],d.properties)}function ya(M,m,l){l===void 0&&(l={});for(var d=J(M),s=d.coordinates,o=0,r=0;r<s.length&&!(m>=o&&r===s.length-1);r++)if(o>=m){var c=m-o;if(c){var u=K(s[r],s[r-1])-180,g=Ma(s[r],c,u,l);return g}else return S(s[r])}else o+=O(s[r],s[r+1],l);return S(s[s.length-1])}const ba={class:"buttons-container"},_a={style:{padding:"8px"}},Ca={key:0},v="gps-trail",Sa=Q({__name:"example-gps",setup(M){var T;const m=A(),l=A("");let d=[];function s(t){l.value=t.id,D(l.value,a=>{r.setLngLat([o[0].lng,o[0].lat]).addTo(a)}),D(l.value,a=>{a.getSource(v)||(a.addSource(v,{type:"geojson",data:{type:"Feature",geometry:{type:"LineString",coordinates:[]}}}),a.addLayer({id:v,type:"line",source:v,paint:{"line-color":"#FF0000","line-width":4}}))})}const o=[{lng:105.84146352698633,lat:21.017689539749725,timestamp:0},{lng:105.84146352698633,lat:21.02072355063092,timestamp:5},{lng:105.84148852917048,lat:21.024177580174765,timestamp:10},{lng:105.84148852917048,lat:21.024177580174765,timestamp:15},{lng:105.8467139857371,lat:21.022567265547778,timestamp:20},{lng:105.8486391539463,lat:21.022030490139215,timestamp:30}],r=new U.Marker({color:"red"}),c=o.map((t,a)=>{const e=o[a+1];return{id:`point-${a}`,duration:e?(e.timestamp-t.timestamp)*1e3:1e3,actions:[{type:"moveMarkerTo",payload:{lng:t.lng,lat:t.lat}},e?{type:"animateSegment",payload:{segment:{start:t,end:e,duration:(e.timestamp-t.timestamp)*1e3}}}:null].filter(f=>!!f)}});(T=c[0].actions)==null||T.push(fa([o[0].lng,o[0].lat],12));const{play:u,pause:g,next:y,prev:b,isPlaying:C,currentIndex:j}=va(l,{chapters:c,autoPlay:!1,autoNext:!0,loop:!1,globalActions:{moveMarkerTo:({lng:t,lat:a})=>({add:()=>{r.setLngLat([t,a])}}),updateTrail:({coord:t})=>({add:()=>{x(t)}}),animateSegment:({segment:t,speed:a=1,onFinish:e})=>({add:()=>{if(!t||!t.start||!t.end||!t.duration){console.error("Invalid segment data",t);return}const f=[t.start.lng,t.start.lat],_=[t.end.lng,t.end.lat];if(q(f,_)){console.warn("Skipping segment: start and end are identical"),e==null||e();return}if(!L(f)||!L(_)){console.error("Invalid coordinates for segment",f,_);return}const N=pa([f,_]),E=ma(N),G=t.duration/a;let h=null;function $(w){h===null&&(h=w);const Z=w-h,B=Math.min(Math.max(Z/G,0),1),P=ya(N,E*B).geometry.coordinates;r.setLngLat(P),x(P),B<1?requestAnimationFrame($):e==null||e()}requestAnimationFrame($)}})}});function x(t){ga(l.value,a=>{d.push(t);const e=a.getSource(v);e&&e.setData({type:"Feature",geometry:{type:"LineString",coordinates:d}})})}function L(t){const[a,e]=t;return!isNaN(a)&&!isNaN(e)&&Math.abs(a)<=180&&Math.abs(e)<=90}const q=(t,a)=>t[0]===a[0]&&t[1]===a[1];return(t,a)=>(I(),W(n(ca),{ref_key:"mapRef",ref:m,onMapLoaded:s},{default:V(()=>[i(n(X),{position:"top-right"}),i(n(Y),{position:"top-right"}),i(n(F)),i(n(aa)),i(n(ta)),i(n(ea)),i(n(na)),i(n(ra)),i(n(sa)),i(n(oa),{position:"bottom-left"}),p("div",ba,[i(n(la),null,{default:V(()=>[p("button",{onClick:a[0]||(a[0]=(...e)=>n(u)&&n(u)(...e))},"Play"),p("button",{onClick:a[1]||(a[1]=(...e)=>n(g)&&n(g)(...e))},"Pause"),p("button",{onClick:a[2]||(a[2]=(...e)=>n(b)&&n(b)(...e))},"Prev"),p("button",{onClick:a[3]||(a[3]=(...e)=>n(y)&&n(y)(...e))},"Next"),p("div",_a,[p("div",null,"Current: "+ua(n(j)),1),n(C)?(I(),ia("div",Ca,"‚èØ Playing")):da("",!0),a[4]||(a[4]=p("div",{id:"btn-highlight"},null,-1))])]),_:1})])]),_:1},512))}});export{Sa as default};
