import{aT as U,aU as b,aV as W,aW as S,aX as R,aY as X,aZ as Y,a_ as z,d as H,r as I,a$ as J,o as V,c as K,w as A,a as l,u as n,aa as O,ad as Q,ae as F,af as aa,ag as ta,ah as ea,ai as na,aj as ra,ak as sa,B as oa,i as m,a1 as ia,h as la,v as da,a6 as ca,M as ua,b0 as ma,b1 as pa,aS as ga}from"./index-C8O7XfGe.js";import{c as fa,u as va,w as D}from"./useStorytelling-D3UZTRIl.js";function Ma(M,p,i,d){d===void 0&&(d={});var s=U(M),o=b(s[0]),r=b(s[1]),u=b(i),c=W(p,d.units),g=Math.asin(Math.sin(r)*Math.cos(c)+Math.cos(r)*Math.sin(c)*Math.cos(u)),_=o+Math.atan2(Math.sin(u)*Math.sin(c)*Math.cos(r),Math.cos(c)-Math.sin(r)*Math.sin(g)),y=R(_),C=R(g);return S([y,C],d.properties)}function _a(M,p,i){i===void 0&&(i={});for(var d=X(M),s=d.coordinates,o=0,r=0;r<s.length&&!(p>=o&&r===s.length-1);r++)if(o>=p){var u=p-o;if(u){var c=Y(s[r],s[r-1])-180,g=Ma(s[r],u,c,i);return g}else return S(s[r])}else o+=z(s[r],s[r+1],i);return S(s[s.length-1])}const ya={class:"buttons-container"},ha={style:{padding:"8px"}},Ca={key:0},ka=m("div",{id:"btn-highlight"},null,-1),v="gps-trail",xa=H({__name:"example-gps",setup(M){var L;const p=I(),i=I("");let d=[];function s(a){i.value=a.id,D(i.value,t=>{r.setLngLat([o[0].lng,o[0].lat]).addTo(t)}),D(i.value,t=>{t.getSource(v)||(t.addSource(v,{type:"geojson",data:{type:"Feature",geometry:{type:"LineString",coordinates:[]}}}),t.addLayer({id:v,type:"line",source:v,paint:{"line-color":"#FF0000","line-width":4}}))})}const o=[{lng:105.84146352698633,lat:21.017689539749725,timestamp:0},{lng:105.84146352698633,lat:21.02072355063092,timestamp:5},{lng:105.84148852917048,lat:21.024177580174765,timestamp:10},{lng:105.84148852917048,lat:21.024177580174765,timestamp:15},{lng:105.8467139857371,lat:21.022567265547778,timestamp:20},{lng:105.8486391539463,lat:21.022030490139215,timestamp:30}],r=new J.Marker({color:"red"}),u=o.map((a,t)=>{const e=o[t+1];return{id:`point-${t}`,duration:e?(e.timestamp-a.timestamp)*1e3:1e3,actions:[{type:"moveMarkerTo",payload:{lng:a.lng,lat:a.lat}},e?{type:"animateSegment",payload:{segment:{start:a,end:e,duration:(e.timestamp-a.timestamp)*1e3}}}:null].filter(f=>!!f)}});(L=u[0].actions)==null||L.push(fa([o[0].lng,o[0].lat],12));const{play:c,pause:g,next:_,prev:y,isPlaying:C,currentIndex:j}=va(i,{chapters:u,autoPlay:!1,autoNext:!0,loop:!1,globalActions:{moveMarkerTo:({lng:a,lat:t})=>({add:()=>{r.setLngLat([a,t])}}),updateTrail:({coord:a})=>({add:()=>{x(a)}}),animateSegment:({segment:a,speed:t=1,onFinish:e})=>({add:()=>{if(!a||!a.start||!a.end||!a.duration){console.error("Invalid segment data",a);return}const f=[a.start.lng,a.start.lat],h=[a.end.lng,a.end.lat];if(q(f,h)){console.warn("Skipping segment: start and end are identical"),e==null||e();return}if(!T(f)||!T(h)){console.error("Invalid coordinates for segment",f,h);return}const N=ma([f,h]),E=pa(N),G=a.duration/t;let k=null;function $(w){k===null&&(k=w);const Z=w-k,B=Math.min(Math.max(Z/G,0),1),P=_a(N,E*B).geometry.coordinates;r.setLngLat(P),x(P),B<1?requestAnimationFrame($):e==null||e()}requestAnimationFrame($)}})}});function x(a){ga(i.value,t=>{d.push(a);const e=t.getSource(v);e&&e.setData({type:"Feature",geometry:{type:"LineString",coordinates:d}})})}function T(a){const[t,e]=a;return!isNaN(t)&&!isNaN(e)&&Math.abs(t)<=180&&Math.abs(e)<=90}const q=(a,t)=>a[0]===t[0]&&a[1]===t[1];return(a,t)=>(V(),K(n(ua),{ref_key:"mapRef",ref:p,onMapLoaded:s},{default:A(()=>[l(n(O),{position:"top-right"}),l(n(Q),{position:"top-right"}),l(n(F)),l(n(aa)),l(n(ta)),l(n(ea)),l(n(na)),l(n(ra)),l(n(sa)),l(n(oa),{position:"bottom-left"}),m("div",ya,[l(n(ca),null,{default:A(()=>[m("button",{onClick:t[0]||(t[0]=(...e)=>n(c)&&n(c)(...e))},"Play"),m("button",{onClick:t[1]||(t[1]=(...e)=>n(g)&&n(g)(...e))},"Pause"),m("button",{onClick:t[2]||(t[2]=(...e)=>n(y)&&n(y)(...e))},"Prev"),m("button",{onClick:t[3]||(t[3]=(...e)=>n(_)&&n(_)(...e))},"Next"),m("div",ha,[m("div",null,"Current: "+ia(n(j)),1),n(C)?(V(),la("div",Ca,"‚èØ Playing")):da("",!0),ka])]),_:1})])]),_:1},512))}});export{xa as default};
