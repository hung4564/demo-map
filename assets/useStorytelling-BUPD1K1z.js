import{aT as g,r as C,K as F}from"./index-DwGWRouJ.js";const K=(t,e)=>({type:"zoomTo",payload:{center:t,zoom:e}}),N=t=>({type:"panTo",payload:{center:t}}),U=t=>({type:"rotateTo",payload:{angle:t}}),Z=t=>({type:"drawRoute",payload:{geojson:t}}),j=t=>({type:"highlightElement",payload:{selector:t}}),k=(t,e=.01,o=5e3)=>({type:"orbitAround",payload:{center:t,radius:e,duration:o}}),B=(t,e,o)=>({type:t,custom:!0,add:e,remove:o}),J=(t=.01,e=5e3)=>({type:"orbitAroundCurrent",payload:{radius:t,duration:e}});function L(t){let e=null;const o=l=>{let s=0;g(t.value,f=>{f.easeTo({center:l,duration:0})});const m=()=>{g(t.value,f=>{f.rotateTo(s,{duration:0})}),s+=.2,e=requestAnimationFrame(m)};m()},a=()=>{e!==null&&(cancelAnimationFrame(e),e=null)};return{orbitAround:l=>({add:()=>{g(t.value,s=>{s.flyTo({center:l.center}),o(l.center)})},remove:()=>a()}),orbitAroundCurrent:()=>({add:()=>{g(t.value,l=>{const s=l.getCenter().toArray();o(s)})},remove:()=>a()})}}function P(t){return{drawRoute:({geojson:e})=>({add:()=>{p(t.value,o=>{var a;(a=o.getSource("route"))==null||a.setData(e)})},remove:()=>{p(t.value,o=>{var a;(a=o.getSource("route"))==null||a.setData({type:"FeatureCollection",features:[]})})}}),zoomTo:e=>({add:()=>{p(t.value,o=>{o.flyTo({center:e.center,zoom:e.zoom})})}}),panTo:e=>({add:()=>{p(t.value,o=>{o.panTo(e.center)})}}),rotateTo:({angle:e})=>({add:()=>{p(t.value,o=>{o.rotateTo(e)})}})}}function p(t,e){g(t,o=>{o.isStyleLoaded()?e(o):o.once("load",()=>e(o))})}function G(t){const{chapters:e,globalActions:o={},autoPlay:a=!1,autoNext:l=!0,delayStart:s=0,loop:m=!1,speed:f}=t,c=C(0),b=C(!1),S=C(f||1);let v=null;const w=()=>{b.value=!0,R()},E=()=>{b.value=!1,h()},O=()=>{c.value<e.length-1?A(c.value+1):m?A(0):E()},q=()=>{c.value>0&&A(c.value-1)},A=n=>{n<0||n>=e.length||(D(n),c.value=n,R())},R=()=>{var r,i;const n=e[c.value];(r=n.onEnter)==null||r.call(n);for(const d of n.actions??[]){const u=x(d);(i=u==null?void 0:u.add)==null||i.call(u)}l&&n.duration&&(h(),v=window.setTimeout(()=>{var d;(d=n.onExit)==null||d.call(n),O()},n.duration/S.value))},D=n=>{var u,z,M;const r=e[c.value],i=e[n],d=new Set(((u=i==null?void 0:i.actions)==null?void 0:u.map(T=>T.type))??[]);(z=r==null?void 0:r.onExit)==null||z.call(r);for(const T of(r==null?void 0:r.actions)??[])if(!d.has(T.type)){const y=x(T);(M=y==null?void 0:y.remove)==null||M.call(y)}h()},x=n=>{if(n.custom)return{add:n.add,remove:n.remove};if(o[n.type])return o[n.type](n.payload)},h=()=>{v!==null&&(clearTimeout(v),v=null)};return a&&setTimeout(w,s),F(()=>{h()}),{currentIndex:c,currentSpeed:S,isPlaying:b,play:w,pause:E,next:O,prev:q,goTo:A}}function Q(t,e){return G({...e,globalActions:{highlightElement:({selector:o})=>({add:()=>{var a;return(a=document.querySelector(o))==null?void 0:a.classList.add("highlight")},remove:()=>{var a;return(a=document.querySelector(o))==null?void 0:a.classList.remove("highlight")}}),...P(t),...L(t),...e.globalActions}})}export{N as a,U as b,K as c,Z as d,j as e,k as f,B as g,J as h,Q as u,p as w};
