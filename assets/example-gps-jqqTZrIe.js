import{aT as U,aU as b,aV as W,aW as S,aX as P,aY as X,aZ as Y,a_ as Z,d as z,r as R,a$ as H,o as I,c as J,w as V,a as l,u as n,a9 as K,ac as O,ad as Q,ae as F,af as aa,ag as ta,ah as ea,ai as na,aj as ra,B as sa,i as c,a0 as oa,h as ia,v as la,a5 as da,M as ua,b0 as ca,b1 as ma,aS as pa}from"./index--6StonPM.js";import{u as ga,w as A}from"./useStorytelling-Dbk8TeNj.js";function fa(M,m,o,d){d===void 0&&(d={});var s=U(M),i=b(s[0]),r=b(s[1]),p=b(o),u=W(m,d.units),g=Math.asin(Math.sin(r)*Math.cos(u)+Math.cos(r)*Math.sin(u)*Math.cos(p)),_=i+Math.atan2(Math.sin(p)*Math.sin(u)*Math.cos(r),Math.cos(u)-Math.sin(r)*Math.sin(g)),y=P(_),C=P(g);return S([y,C],d.properties)}function va(M,m,o){o===void 0&&(o={});for(var d=X(M),s=d.coordinates,i=0,r=0;r<s.length&&!(m>=i&&r===s.length-1);r++)if(i>=m){var p=m-i;if(p){var u=Y(s[r],s[r-1])-180,g=fa(s[r],p,u,o);return g}else return S(s[r])}else i+=Z(s[r],s[r+1],o);return S(s[s.length-1])}const Ma={class:"buttons-container"},_a={style:{padding:"8px"}},ya={key:0},ha=c("div",{id:"btn-highlight"},null,-1),v="gps-trail",ba=z({__name:"example-gps",setup(M){const m=R(),o=R("");let d=[];function s(a){o.value=a.id,A(o.value,t=>{r.setLngLat([i[0].lng,i[0].lat]).addTo(t)}),A(o.value,t=>{t.getSource(v)||(t.addSource(v,{type:"geojson",data:{type:"Feature",geometry:{type:"LineString",coordinates:[]}}}),t.addLayer({id:v,type:"line",source:v,paint:{"line-color":"#FF0000","line-width":4}}))})}const i=[{lng:105.84146352698633,lat:21.017689539749725,timestamp:0},{lng:105.84146352698633,lat:21.02072355063092,timestamp:5},{lng:105.84148852917048,lat:21.024177580174765,timestamp:10},{lng:105.84148852917048,lat:21.024177580174765,timestamp:15},{lng:105.8467139857371,lat:21.022567265547778,timestamp:20},{lng:105.8486391539463,lat:21.022030490139215,timestamp:30}],r=new H.Marker({color:"red"}),p=i.map((a,t)=>{const e=i[t+1];return{id:`point-${t}`,duration:e?(e.timestamp-a.timestamp)*1e3:1e3,actions:[{type:"moveMarkerTo",payload:{lng:a.lng,lat:a.lat}},e?{type:"animateSegment",payload:{segment:{start:a,end:e,duration:(e.timestamp-a.timestamp)*1e3}}}:null].filter(f=>!!f)}}),{play:u,pause:g,next:_,prev:y,isPlaying:C,currentIndex:D}=ga(o,{chapters:p,autoPlay:!1,autoNext:!0,loop:!1,globalActions:{moveMarkerTo:({lng:a,lat:t})=>({add:()=>{r.setLngLat([a,t])}}),updateTrail:({coord:a})=>({add:()=>{x(a)}}),animateSegment:({segment:a,speed:t=1,onFinish:e})=>({add:()=>{if(!a||!a.start||!a.end||!a.duration){console.error("Invalid segment data",a);return}const f=[a.start.lng,a.start.lat],h=[a.end.lng,a.end.lat];if(j(f,h)){console.warn("Skipping segment: start and end are identical"),e==null||e();return}if(!T(f)||!T(h)){console.error("Invalid coordinates for segment",f,h);return}const L=ca([f,h]),q=ma(L),E=a.duration/t;let k=null;function N($){k===null&&(k=$);const G=$-k,w=Math.min(Math.max(G/E,0),1),B=va(L,q*w).geometry.coordinates;r.setLngLat(B),x(B),w<1?requestAnimationFrame(N):e==null||e()}requestAnimationFrame(N)}})}});function x(a){pa(o.value,t=>{d.push(a);const e=t.getSource(v);e&&e.setData({type:"Feature",geometry:{type:"LineString",coordinates:d}})})}function T(a){const[t,e]=a;return!isNaN(t)&&!isNaN(e)&&Math.abs(t)<=180&&Math.abs(e)<=90}const j=(a,t)=>a[0]===t[0]&&a[1]===t[1];return(a,t)=>(I(),J(n(ua),{ref_key:"mapRef",ref:m,onMapLoaded:s},{default:V(()=>[l(n(K),{position:"top-right"}),l(n(O),{position:"top-right"}),l(n(Q)),l(n(F)),l(n(aa)),l(n(ta)),l(n(ea)),l(n(na)),l(n(ra)),l(n(sa),{position:"bottom-left"}),c("div",Ma,[l(n(da),null,{default:V(()=>[c("button",{onClick:t[0]||(t[0]=(...e)=>n(u)&&n(u)(...e))},"Play"),c("button",{onClick:t[1]||(t[1]=(...e)=>n(g)&&n(g)(...e))},"Pause"),c("button",{onClick:t[2]||(t[2]=(...e)=>n(y)&&n(y)(...e))},"Prev"),c("button",{onClick:t[3]||(t[3]=(...e)=>n(_)&&n(_)(...e))},"Next"),c("div",_a,[c("div",null,"Current: "+oa(n(D)),1),n(C)?(I(),ia("div",ya,"‚èØ Playing")):la("",!0),ha])]),_:1})])]),_:1},512))}});export{ba as default};
