import{aT as p,r as C,K as F}from"./index-D9z0B4lh.js";const K=(t,e)=>({type:"zoomTo",payload:{center:t,zoom:e}}),N=t=>({type:"panTo",payload:{center:t}}),U=t=>({type:"rotateTo",payload:{angle:t}}),Z=t=>({type:"drawRoute",payload:{geojson:t}}),j=t=>({type:"highlightElement",payload:{selector:t}}),k=(t,e=.01,o=5e3)=>({type:"orbitAround",payload:{center:t,radius:e,duration:o}}),B=(t,e,o)=>({type:t,custom:!0,add:e,remove:o}),J=(t=.01,e=5e3)=>({type:"orbitAroundCurrent",payload:{radius:t,duration:e}});function L(t){let e=null;const o=c=>{let u=0;p(t.value,v=>{v.easeTo({center:c,duration:0})});const m=()=>{p(t.value,v=>{v.rotateTo(u,{duration:0})}),u+=.2,e=requestAnimationFrame(m)};m()},n=()=>{e!==null&&(cancelAnimationFrame(e),e=null)};return{orbitAround:c=>({add:()=>{p(t.value,u=>{u.flyTo({center:c.center}),o(c.center)})},remove:()=>n()}),orbitAroundCurrent:()=>({add:()=>{p(t.value,c=>{const u=c.getCenter().toArray();o(u)})},remove:()=>n()})}}function P(t){return{drawRoute:({geojson:e})=>({add:()=>{f(t.value,o=>{var n;(n=o.getSource("route"))==null||n.setData(e)})},remove:()=>{f(t.value,o=>{var n;(n=o.getSource("route"))==null||n.setData({type:"FeatureCollection",features:[]})})}}),zoomTo:e=>({add:()=>{f(t.value,o=>{o.flyTo({center:e.center,zoom:e.zoom})})}}),panTo:e=>({add:()=>{f(t.value,o=>{o.panTo(e.center)})}}),rotateTo:({angle:e})=>({add:()=>{f(t.value,o=>{o.rotateTo(e)})}})}}function f(t,e){p(t,o=>{o.isStyleLoaded()?e(o):o.once("load",()=>e(o))})}function G(t){const{chapters:e,globalActions:o={},autoPlay:n=!1,autoNext:c=!0,delayStart:u=0,loop:m=!1,speed:v}=t,r=C(0),b=C(!1),S=C(v||1);let h=null;const w=()=>{b.value=!0,O()},x=()=>{b.value=!1,T()},E=()=>{r.value<e.length-1?A(r.value+1):m?A(0):x()},q=()=>{r.value>0&&A(r.value-1)},A=a=>{a<0||a>=e.length||(D(a),r.value=a,O())},O=()=>{var l,g;const a=e[r.value];console.log("test",r.value,"start"),console.log("test",r.value,"start","chapter",a),(l=a.onEnter)==null||l.call(a);for(const s of a.actions??[]){console.log("test",r.value,"start","action",s);const i=R(s);(g=i==null?void 0:i.add)==null||g.call(i)}c&&a.duration&&(T(),h=window.setTimeout(()=>{var s;console.log("test",r.value,"start","exit"),(s=a.onExit)==null||s.call(a),E()},a.duration/S.value))},D=a=>{var i,z,M;console.log("test",r.value,"end","exit");const l=e[r.value];console.log("test",r.value,"end","chapter",l);const g=e[a],s=new Set(((i=g==null?void 0:g.actions)==null?void 0:i.map(d=>d.type))??[]);(z=l==null?void 0:l.onExit)==null||z.call(l);for(const d of(l==null?void 0:l.actions)??[])if(console.log("test",r.value,"end","action",d,s,s.has(d.type)),!s.has(d.type)){const y=R(d);(M=y==null?void 0:y.remove)==null||M.call(y),console.log("test",r.value,"end","remove action",d)}T()},R=a=>{if(a.custom)return{add:a.add,remove:a.remove};if(o[a.type])return o[a.type](a.payload)},T=()=>{h!==null&&(clearTimeout(h),h=null)};return n&&setTimeout(w,u),F(()=>{T()}),{currentIndex:r,currentSpeed:S,isPlaying:b,play:w,pause:x,next:E,prev:q,goTo:A}}function Q(t,e){return G({...e,globalActions:{highlightElement:({selector:o})=>({add:()=>{var n;return(n=document.querySelector(o))==null?void 0:n.classList.add("highlight")},remove:()=>{var n;return(n=document.querySelector(o))==null?void 0:n.classList.remove("highlight")}}),...P(t),...L(t),...e.globalActions}})}export{N as a,U as b,K as c,Z as d,j as e,k as f,B as g,J as h,Q as u,f as w};
