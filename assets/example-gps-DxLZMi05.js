import{aS as U,aT as b,aU as W,aV as S,aW as R,aX as X,aY as Y,aZ as z,d as H,C as I,a_ as J,c as K,o as V,w as A,u as n,M as O,a$ as Q,b0 as F,a9 as aa,a as l,b as m,ar as ta,_ as ea,au as na,f as ra,av as sa,g as oa,h as ia,i as la,j as da,B as ua,k as ca,T as ma,ah as pa,ak as ga}from"./index-C8lTQC7N.js";import{c as fa,u as va,w as D}from"./useStorytelling-CV7B42S5.js";function Ma(M,p,i,d){d===void 0&&(d={});var s=U(M),o=b(s[0]),r=b(s[1]),c=b(i),u=W(p,d.units),g=Math.asin(Math.sin(r)*Math.cos(u)+Math.cos(r)*Math.sin(u)*Math.cos(c)),y=o+Math.atan2(Math.sin(c)*Math.sin(u)*Math.cos(r),Math.cos(u)-Math.sin(r)*Math.sin(g)),_=R(y),h=R(g);return S([_,h],d.properties)}function ya(M,p,i){i===void 0&&(i={});for(var d=X(M),s=d.coordinates,o=0,r=0;r<s.length&&!(p>=o&&r===s.length-1);r++)if(o>=p){var c=p-o;if(c){var u=Y(s[r],s[r-1])-180,g=Ma(s[r],c,u,i);return g}else return S(s[r])}else o+=z(s[r],s[r+1],i);return S(s[s.length-1])}const _a={class:"buttons-container"},Ca={style:{padding:"8px"}},ha={key:0},v="gps-trail",Sa=H({__name:"example-gps",setup(M){var L;const p=I(),i=I("");let d=[];function s(t){i.value=t.id,D(i.value,a=>{r.setLngLat([o[0].lng,o[0].lat]).addTo(a)}),D(i.value,a=>{a.getSource(v)||(a.addSource(v,{type:"geojson",data:{type:"Feature",geometry:{type:"LineString",coordinates:[]}}}),a.addLayer({id:v,type:"line",source:v,paint:{"line-color":"#FF0000","line-width":4}}))})}const o=[{lng:105.84146352698633,lat:21.017689539749725,timestamp:0},{lng:105.84146352698633,lat:21.02072355063092,timestamp:5},{lng:105.84148852917048,lat:21.024177580174765,timestamp:10},{lng:105.84148852917048,lat:21.024177580174765,timestamp:15},{lng:105.8467139857371,lat:21.022567265547778,timestamp:20},{lng:105.8486391539463,lat:21.022030490139215,timestamp:30}],r=new J.Marker({color:"red"}),c=o.map((t,a)=>{const e=o[a+1];return{id:`point-${a}`,duration:e?(e.timestamp-t.timestamp)*1e3:1e3,actions:[{type:"moveMarkerTo",payload:{lng:t.lng,lat:t.lat}},e?{type:"animateSegment",payload:{segment:{start:t,end:e,duration:(e.timestamp-t.timestamp)*1e3}}}:null].filter(f=>!!f)}});(L=c[0].actions)==null||L.push(fa([o[0].lng,o[0].lat],12));const{play:u,pause:g,next:y,prev:_,isPlaying:h,currentIndex:j}=va(i,{chapters:c,autoPlay:!1,autoNext:!0,loop:!1,globalActions:{moveMarkerTo:({lng:t,lat:a})=>({add:()=>{r.setLngLat([t,a])}}),updateTrail:({coord:t})=>({add:()=>{T(t)}}),animateSegment:({segment:t,speed:a=1,onFinish:e})=>({add:()=>{if(!t||!t.start||!t.end||!t.duration){console.error("Invalid segment data",t);return}const f=[t.start.lng,t.start.lat],C=[t.end.lng,t.end.lat];if(q(f,C)){console.warn("Skipping segment: start and end are identical"),e==null||e();return}if(!x(f)||!x(C)){console.error("Invalid coordinates for segment",f,C);return}const N=Q([f,C]),E=F(N),G=t.duration/a;let k=null;function $(w){k===null&&(k=w);const Z=w-k,B=Math.min(Math.max(Z/G,0),1),P=ya(N,E*B).geometry.coordinates;r.setLngLat(P),T(P),B<1?requestAnimationFrame($):e==null||e()}requestAnimationFrame($)}})}});function T(t){aa(i.value,a=>{d.push(t);const e=a.getSource(v);e&&e.setData({type:"Feature",geometry:{type:"LineString",coordinates:d}})})}function x(t){const[a,e]=t;return!isNaN(a)&&!isNaN(e)&&Math.abs(a)<=180&&Math.abs(e)<=90}const q=(t,a)=>t[0]===a[0]&&t[1]===a[1];return(t,a)=>(V(),K(n(O),{ref_key:"mapRef",ref:p,onMapLoaded:s},{default:A(()=>[l(n(ta),{position:"top-right"}),l(n(ea),{position:"top-right"}),l(n(na)),l(n(ra)),l(n(sa)),l(n(oa)),l(n(ia)),l(n(la)),l(n(da)),l(n(ua),{position:"bottom-left"}),m("div",_a,[l(n(ga),null,{default:A(()=>[m("button",{onClick:a[0]||(a[0]=(...e)=>n(u)&&n(u)(...e))},"Play"),m("button",{onClick:a[1]||(a[1]=(...e)=>n(g)&&n(g)(...e))},"Pause"),m("button",{onClick:a[2]||(a[2]=(...e)=>n(_)&&n(_)(...e))},"Prev"),m("button",{onClick:a[3]||(a[3]=(...e)=>n(y)&&n(y)(...e))},"Next"),m("div",Ca,[m("div",null,"Current: "+pa(n(j)),1),n(h)?(V(),ca("div",ha,"‚èØ Playing")):ma("",!0),a[4]||(a[4]=m("div",{id:"btn-highlight"},null,-1))])]),_:1})])]),_:1},512))}});export{Sa as default};
