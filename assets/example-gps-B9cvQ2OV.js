import{aU as U,aV as k,aW as W,aX as S,aY as R,aZ as X,a_ as Y,a$ as z,d as H,r as I,b0 as J,o as V,c as K,w as A,a as l,u as n,ab as O,ae as Q,af as F,ag as aa,ah as ta,ai as ea,aj as na,ak as ra,al as oa,B as sa,i as m,a2 as ia,h as la,v as da,a7 as ca,M as ua,b1 as ma,b2 as pa,aT as ga}from"./index-D9z0B4lh.js";import{c as fa,u as va,w as D}from"./useStorytelling-BDBBeQN3.js";function Ma(M,p,i,d){d===void 0&&(d={});var o=U(M),s=k(o[0]),r=k(o[1]),u=k(i),c=W(p,d.units),g=Math.asin(Math.sin(r)*Math.cos(c)+Math.cos(r)*Math.sin(c)*Math.cos(u)),_=s+Math.atan2(Math.sin(u)*Math.sin(c)*Math.cos(r),Math.cos(c)-Math.sin(r)*Math.sin(g)),y=R(_),C=R(g);return S([y,C],d.properties)}function _a(M,p,i){i===void 0&&(i={});for(var d=X(M),o=d.coordinates,s=0,r=0;r<o.length&&!(p>=s&&r===o.length-1);r++)if(s>=p){var u=p-s;if(u){var c=Y(o[r],o[r-1])-180,g=Ma(o[r],u,c,i);return g}else return S(o[r])}else s+=z(o[r],o[r+1],i);return S(o[o.length-1])}const ya={class:"buttons-container"},ha={style:{padding:"8px"}},Ca={key:0},ba=m("div",{id:"btn-highlight"},null,-1),v="gps-trail",xa=H({__name:"example-gps",setup(M){var L;const p=I(),i=I("");let d=[];function o(a){i.value=a.id,D(i.value,t=>{r.setLngLat([s[0].lng,s[0].lat]).addTo(t)}),D(i.value,t=>{t.getSource(v)||(t.addSource(v,{type:"geojson",data:{type:"Feature",geometry:{type:"LineString",coordinates:[]}}}),t.addLayer({id:v,type:"line",source:v,paint:{"line-color":"#FF0000","line-width":4}}))})}const s=[{lng:105.84146352698633,lat:21.017689539749725,timestamp:0},{lng:105.84146352698633,lat:21.02072355063092,timestamp:5},{lng:105.84148852917048,lat:21.024177580174765,timestamp:10},{lng:105.84148852917048,lat:21.024177580174765,timestamp:15},{lng:105.8467139857371,lat:21.022567265547778,timestamp:20},{lng:105.8486391539463,lat:21.022030490139215,timestamp:30}],r=new J.Marker({color:"red"}),u=s.map((a,t)=>{const e=s[t+1];return{id:`point-${t}`,duration:e?(e.timestamp-a.timestamp)*1e3:1e3,actions:[{type:"moveMarkerTo",payload:{lng:a.lng,lat:a.lat}},e?{type:"animateSegment",payload:{segment:{start:a,end:e,duration:(e.timestamp-a.timestamp)*1e3}}}:null].filter(f=>!!f)}});(L=u[0].actions)==null||L.push(fa([s[0].lng,s[0].lat],12));const{play:c,pause:g,next:_,prev:y,isPlaying:C,currentIndex:j}=va(i,{chapters:u,autoPlay:!1,autoNext:!0,loop:!1,globalActions:{moveMarkerTo:({lng:a,lat:t})=>({add:()=>{r.setLngLat([a,t])}}),updateTrail:({coord:a})=>({add:()=>{x(a)}}),animateSegment:({segment:a,speed:t=1,onFinish:e})=>({add:()=>{if(!a||!a.start||!a.end||!a.duration){console.error("Invalid segment data",a);return}const f=[a.start.lng,a.start.lat],h=[a.end.lng,a.end.lat];if(q(f,h)){console.warn("Skipping segment: start and end are identical"),e==null||e();return}if(!T(f)||!T(h)){console.error("Invalid coordinates for segment",f,h);return}const N=ma([f,h]),E=pa(N),G=a.duration/t;let b=null;function $(w){b===null&&(b=w);const Z=w-b,B=Math.min(Math.max(Z/G,0),1),P=_a(N,E*B).geometry.coordinates;r.setLngLat(P),x(P),B<1?requestAnimationFrame($):e==null||e()}requestAnimationFrame($)}})}});function x(a){ga(i.value,t=>{d.push(a);const e=t.getSource(v);e&&e.setData({type:"Feature",geometry:{type:"LineString",coordinates:d}})})}function T(a){const[t,e]=a;return!isNaN(t)&&!isNaN(e)&&Math.abs(t)<=180&&Math.abs(e)<=90}const q=(a,t)=>a[0]===t[0]&&a[1]===t[1];return(a,t)=>(V(),K(n(ua),{ref_key:"mapRef",ref:p,onMapLoaded:o},{default:A(()=>[l(n(O),{position:"top-right"}),l(n(Q),{position:"top-right"}),l(n(F)),l(n(aa)),l(n(ta)),l(n(ea)),l(n(na)),l(n(ra)),l(n(oa)),l(n(sa),{position:"bottom-left"}),m("div",ya,[l(n(ca),null,{default:A(()=>[m("button",{onClick:t[0]||(t[0]=(...e)=>n(c)&&n(c)(...e))},"Play"),m("button",{onClick:t[1]||(t[1]=(...e)=>n(g)&&n(g)(...e))},"Pause"),m("button",{onClick:t[2]||(t[2]=(...e)=>n(y)&&n(y)(...e))},"Prev"),m("button",{onClick:t[3]||(t[3]=(...e)=>n(_)&&n(_)(...e))},"Next"),m("div",ha,[m("div",null,"Current: "+ia(n(j)),1),n(C)?(V(),la("div",Ca,"‚èØ Playing")):da("",!0),ba])]),_:1})])]),_:1},512))}});export{xa as default};
