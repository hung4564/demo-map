import{aS as A,r as k,K as O,d as z,o as B,c as D,w as E,a as u,u as s,a9 as q,ac as V,ad as j,ae as G,af as H,ag as K,ah as U,ai as Z,aj as J,B as Q,i as g,a0 as W,h as X,v as Y,a5 as I,M as tt}from"./index-BxQNSTjB.js";const L=(t,e)=>({type:"zoomTo",payload:{center:t,zoom:e}}),et=t=>({type:"panTo",payload:{center:t}}),ot=t=>({type:"rotateTo",payload:{angle:t}}),at=t=>({type:"drawRoute",payload:{geojson:t}}),nt=t=>({type:"highlightElement",payload:{selector:t}}),st=(t,e=.01,o=5e3)=>({type:"orbitAround",payload:{center:t,radius:e,duration:o}}),it=(t,e,o)=>({type:t,custom:!0,add:e,remove:o}),rt=(t=.01,e=5e3)=>({type:"orbitAroundCurrent",payload:{radius:t,duration:e}});function lt(t){let e=null;const o=d=>{let c=0;A(t.value,n=>{n.easeTo({center:d,duration:0})});const m=()=>{A(t.value,n=>{n.rotateTo(c,{duration:0})}),c+=.2,e=requestAnimationFrame(m)};m()},i=()=>{e!==null&&(cancelAnimationFrame(e),e=null)};return{orbitAround:d=>({add:()=>{A(t.value,c=>{c.flyTo({center:d.center}),o(d.center)})},remove:()=>i()}),orbitAroundCurrent:()=>({add:()=>{A(t.value,d=>{const c=d.getCenter().toArray();o(c)})},remove:()=>i()})}}function ct(t){return{drawRoute:({geojson:e})=>({add:()=>{S(t.value,o=>{var i;(i=o.getSource("route"))==null||i.setData(e)})},remove:()=>{S(t.value,o=>{var i;(i=o.getSource("route"))==null||i.setData({type:"FeatureCollection",features:[]})})}}),zoomTo:e=>({add:()=>{S(t.value,o=>{o.flyTo({center:e.center,zoom:e.zoom})})}}),panTo:e=>({add:()=>{S(t.value,o=>{o.panTo(e.center)})}}),rotateTo:({angle:e})=>({add:()=>{S(t.value,o=>{o.rotateTo(e)})}})}}function S(t,e){A(t,o=>{o.isStyleLoaded()?e(o):o.once("load",()=>e(o))})}function ut(t){console.log("test","useStorytelling",t);const{chapters:e,globalActions:o={},autoPlay:i=!1,autoNext:d=!0,delayStart:c=0,loop:m=!1}=t,n=k(0),h=k(!1);let C=null;const x=()=>{h.value=!0,P()},_=()=>{h.value=!1,M()},r=()=>{n.value<e.length-1?w(n.value+1):m?w(0):_()},p=()=>{n.value>0&&w(n.value-1)},w=a=>{a<0||a>=e.length||(N(a),n.value=a,P())},P=()=>{var l,b;const a=e[n.value];console.log("test",n.value,"start"),console.log("test",n.value,"start","chapter",a),(l=a.onEnter)==null||l.call(a);for(const f of a.actions??[]){console.log("test",n.value,"start","action",f);const y=F(f);(b=y==null?void 0:y.add)==null||b.call(y)}d&&a.duration&&(M(),C=window.setTimeout(()=>{var f;console.log("test",n.value,"start","exit"),(f=a.onExit)==null||f.call(a),r()},a.duration))},N=a=>{var y,R,$;console.log("test",n.value,"end","exit");const l=e[n.value];console.log("test",n.value,"end","chapter",l);const b=e[a],f=new Set(((y=b==null?void 0:b.actions)==null?void 0:y.map(v=>v.type))??[]);(R=l==null?void 0:l.onExit)==null||R.call(l);for(const v of(l==null?void 0:l.actions)??[])if(console.log("test",n.value,"end","action",v,f,f.has(v.type)),!f.has(v.type)){const T=F(v);($=T==null?void 0:T.remove)==null||$.call(T),console.log("test",n.value,"end","remove action",v)}M()},F=a=>{if(a.custom)return{add:a.add,remove:a.remove};if(o[a.type])return o[a.type](a.payload)},M=()=>{C!==null&&(clearTimeout(C),C=null)};return i&&setTimeout(x,c),O(()=>{M()}),{currentIndex:n,isPlaying:h,play:x,pause:_,next:r,prev:p,goTo:w}}function dt(t,e){return ut({...e,globalActions:{highlightElement:({selector:o})=>({add:()=>{var i;return(i=document.querySelector(o))==null?void 0:i.classList.add("highlight")},remove:()=>{var i;return(i=document.querySelector(o))==null?void 0:i.classList.remove("highlight")}}),...ct(t),...lt(t),...e.globalActions}})}const pt={class:"buttons-container"},ft={style:{padding:"8px"}},yt={key:0},gt=g("div",{id:"btn-highlight"},null,-1),vt=z({__name:"example",setup(t){const e=k(),o=k("");function i(_){o.value=_.id,A(_.id,r=>{r.addSource("route",{type:"geojson",data:{type:"FeatureCollection",features:[]}}),r.addLayer({id:"line-layer",type:"line",source:"route",paint:{"line-color":"#FF0000","line-width":4,"line-opacity":.8}})})}const d=[{id:"1",duration:3e3,actions:[L([105.85,21.03],12)]},{id:"2",duration:3e3,actions:[et([105.82,21.07])]},{id:"3",duration:3e3,actions:[ot(180)]},{id:"4",duration:3e3,actions:[at({type:"FeatureCollection",features:[{type:"Feature",properties:{},geometry:{type:"LineString",coordinates:[[105.84,21.03],[105.85,21.05],[105.86,21.07]]}}]})]},{id:"5",duration:3e3,actions:[nt("#btn-highlight")]},{id:"6",duration:6e3,actions:[st([105.85,21],.005,6e3)]},{id:"8",duration:3e3,actions:[it("log",()=>console.log("Chapter 9 started"),()=>console.log("Chapter 9 ended"))]},{id:"9",duration:3e3,actions:[L([105.86,21.08],15)]},{id:"6",duration:6e3,actions:[rt(.005,6e3)]}],{play:c,pause:m,next:n,prev:h,isPlaying:C,currentIndex:x}=dt(o,{chapters:d,autoPlay:!1,autoNext:!0,loop:!0});return(_,r)=>(B(),D(s(tt),{ref_key:"mapRef",ref:e,onMapLoaded:i},{default:E(()=>[u(s(q),{position:"top-right"}),u(s(V),{position:"top-right"}),u(s(j)),u(s(G)),u(s(H)),u(s(K)),u(s(U)),u(s(Z)),u(s(J)),u(s(Q),{position:"bottom-left"}),g("div",pt,[u(s(I),null,{default:E(()=>[g("button",{onClick:r[0]||(r[0]=(...p)=>s(c)&&s(c)(...p))},"Play"),g("button",{onClick:r[1]||(r[1]=(...p)=>s(m)&&s(m)(...p))},"Pause"),g("button",{onClick:r[2]||(r[2]=(...p)=>s(h)&&s(h)(...p))},"Prev"),g("button",{onClick:r[3]||(r[3]=(...p)=>s(n)&&s(n)(...p))},"Next"),g("div",ft,[g("div",null,"Current: "+W(s(x)),1),s(C)?(B(),X("div",yt,"‚èØ Playing")):Y("",!0),gt])]),_:1})])]),_:1},512))}});export{vt as default};
